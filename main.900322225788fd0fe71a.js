(()=>{"use strict";const e=function(e,t){let i=!0;const r=Array(t).fill(!1),s=e.toLowerCase().split(" ").join("-");return Object.freeze({get name(){return e},get id(){return s},get length(){return t},get isHorizontal(){return i},get hits(){return r},hit:e=>{r[e]=!0},isSunk:()=>r.every((e=>e)),toggleOrientation:()=>{i=!i}})},t=10,i=[{name:"Destroyer",id:"destroyer",length:2},{name:"Cruiser",id:"cruiser",length:3},{name:"Submarine",id:"submarine",length:3},{name:"Battleship",id:"battleship",length:4},{name:"Carrier",id:"carrier",length:5}];function r(){return[Math.floor(Math.random()*t),Math.floor(Math.random()*t)]}const s=function(t,s="human"){let a=1===t;const n="computer"===s;let l=i.map((t=>e(t.name,t.length)));const d=e=>{a=e},o=e=>{const[t,i]=r();e.isValidAttack(t,i)?e.receiveAttack(t,i):o(e)},c=()=>{l=i.map((t=>e(t.name,t.length)))};return Object.freeze({get turn(){return a},get isAi(){return n},get ships(){return l},toggleTurn:()=>{a=!a},setTurn:d,attack:(e,t,i)=>{e.receiveAttack(t,i)},randomAttack:o,autoPlaceAllShips:e=>{l.forEach((t=>{e.autoPlaceShip(t)}))},invertShips:()=>{l.forEach((e=>{e.toggleOrientation()}))},resetShips:c,reset:()=>{c(),d(1===t)}})},a=function(){let e=Array(t).fill(0).map((e=>Array(t).fill("empty"))),i=[];const s=(i,r,s)=>((e,i,r)=>{if(e.isHorizontal){if(t-r>=e.length)return!0}else if(t-i>=e.length)return!0;return!1})(i,r,s)&&((t,i,r)=>{let s=!0;if(t.isHorizontal){for(let a=0;a<t.length;a++)if(e[i][r+a].ship){s=!1;break}}else for(let a=0;a<t.length;a++)if(e[i+a][r].ship){s=!1;break}return s})(i,r,s),a=(t,r,s)=>{if(t.isHorizontal)for(let i=0;i<t.length;i++)e[r][s+i]={ship:t,hit:!1,index:i};else for(let i=0;i<t.length;i++)e[r+i][s]={ship:t,hit:!1,index:i};i.push(t)},n=e=>{const[t,i]=r();1===Math.floor(2*Math.random())&&e.toggleOrientation(),s(e,t,i)?a(e,t,i):n(e)};return Object.freeze({get board(){return e},get placedShips(){return i},isValidPosition:s,placeShip:a,autoPlaceShip:n,receiveAttack:(t,i)=>{if(e[t][i].ship){const r=e[t][i].ship,s=e[t][i].index;r.hit(s),e[t][i].hit=!0}else e[t][i]="miss"},areShipsSunk:()=>i.every((e=>e.hits.every((e=>e)))),isValidAttack:(t,i)=>!e[t][i].hit&&"miss"!==e[t][i],reset:()=>{e=Array(t).fill(0).map((e=>Array(t).fill("empty"))),i=[]}})},n={p1Grid:document.querySelector(".p1-grid"),p2Grid:document.querySelector(".p2-grid"),shipsContainer:document.querySelector(".ships-container"),controlBtns:document.querySelector(".control-buttons"),startBtn:document.querySelector("#start-btn"),autoPlaceBtn:document.querySelector("#auto-place-btn"),changeOrientationBtn:document.querySelector("#change-orientation-btn"),resetBtn:document.querySelector("#reset-btn"),playAgainBtn:document.querySelector("#play-again-btn"),playerNames:document.querySelectorAll(".player-name"),modalBg:document.querySelector(".modal-bg"),modelText:document.querySelector(".modal-text")},l=(()=>{const e=e=>{e.textContent=""};return Object.freeze({renderGrid:(i,r,s)=>{e(r);for(let e=0;e<t;e++)for(let a=0;a<t;a++){const t=document.createElement("div"),n=i[e][a];if(t.classList.add("grid-cell"),t.dataset.y=e,t.dataset.x=a,"miss"===n)t.classList.add("miss");else if(n.ship)if(n.hit)t.classList.add("danger");else if(!s){const e=document.createElement("div");e.classList.add("placed-ship-square"),t.appendChild(e)}r.appendChild(t)}},createShips:e=>{i.forEach(((t,i)=>{const r=document.createElement("div");r.classList.add("ship",t.id),r.draggable=!0,r.dataset.index=i;for(let e=0;e<t.length;e++){const i=document.createElement("div");i.classList.add("ship-square",`${t.id}-${e}`),i.dataset.index=e,r.appendChild(i)}e.appendChild(r)}))},changeOrientation:()=>{n.shipsContainer.classList.toggle("horizontal"),n.shipsContainer.classList.toggle("vertical")},resetDirection:()=>{n.shipsContainer.classList.add("horizontal"),n.shipsContainer.classList.remove("vertical")},clearGrid:e,hideShips:()=>{document.querySelectorAll(".ship").forEach((e=>{e.classList.add("removed")}))},showShips:()=>{document.querySelectorAll(".ship").forEach((e=>{e.classList.remove("removed")}))},showModal:e=>{n.modelText.textContent=e,n.modalBg.style.display="flex"},hideModal:()=>{n.modelText.textContent="",n.modalBg.style.display="none"},showPlayAgainButton:()=>{n.playAgainBtn.classList.remove("invisible")},hidePlayAgainButton:()=>{n.playAgainBtn.classList.add("invisible")},startGame:()=>{n.p2Grid.classList.remove("invisible"),n.shipsContainer.classList.add("invisible"),n.controlBtns.classList.add("invisible"),n.startBtn.classList.add("invisible"),n.playerNames.forEach((e=>{e.classList.remove("invisible")}))},resetGame:()=>{n.p2Grid.classList.add("invisible"),n.shipsContainer.classList.remove("invisible"),n.controlBtns.classList.remove("invisible"),n.startBtn.classList.remove("invisible"),n.playerNames.forEach((e=>{e.classList.add("invisible")}))}})})();(()=>{const e=s(1),t=s(2,"computer"),r=a(),d=a(),o=((e,t,i)=>{let r,s,a=[];const n=()=>{a.forEach((e=>{e.classList.remove("success")})),a=[]},d=()=>{r=null},o=e=>{s=e.target.dataset.index},c=e=>{r=e.target,setTimeout((()=>{r.classList.add("invisible")}),0)},h=e=>{e.target.classList.remove("invisible"),n(),d()},u=e=>{e.preventDefault()},p=l=>{if(l.preventDefault(),r){const d=l.target,o=d.dataset.y,c=d.dataset.x,h=e.ships[r.dataset.index],u=o-(h.isHorizontal?0:s),p=c-(h.isHorizontal?s:0);if(t.isValidPosition(h,u,p))if(n(),h.isHorizontal)for(let e=0;e<h.length;e++)i.childNodes[10*u+p+e].classList.add("success"),a.push(i.childNodes[10*u+p+e]);else for(let e=0;e<h.length;e++)i.childNodes[10*(u+e)+p].classList.add("success"),a.push(i.childNodes[10*(u+e)+p])}},g=e=>{},m=s=>{if(a.length>0&&r){const s=Number(a[0].dataset.y),n=Number(a[0].dataset.x),o=e.ships[r.dataset.index];t.isValidPosition(o,s,n)&&(t.placeShip(o,s,n),l.renderGrid(t.board,i,!1),f(),r.classList.add("removed"),d())}},v=()=>{document.querySelectorAll(".ship").forEach((e=>{e.addEventListener("dragstart",c),e.addEventListener("dragend",h),e.addEventListener("mousedown",o)}))},f=()=>{i.querySelectorAll(".grid-cell").forEach((e=>{e.addEventListener("dragover",u),e.addEventListener("dragenter",p),e.addEventListener("dragleave",g),e.addEventListener("drop",m)}))};return Object.freeze({addDragDropListeners:()=>{v(),f()},addShipListeners:v,addGridCellListeners:f})})(e,r,n.p1Grid),c=()=>{e.invertShips(),l.changeOrientation()},h=()=>{r.reset(),e.autoPlaceAllShips(r),l.hideShips(),l.renderGrid(r.board,n.p1Grid,!1),o.addDragDropListeners()},u=()=>{r.reset(),e.resetShips(),l.resetDirection(),l.renderGrid(r.board,n.p1Grid,!1),o.addGridCellListeners(),l.showShips()},p=()=>{e.reset(),t.reset(),r.reset(),d.reset(),l.resetGame(),l.showShips(),l.renderGrid(r.board,n.p1Grid),l.renderGrid(d.board,n.p2Grid),l.hideModal(),o.addGridCellListeners()},g=e=>{e.target.classList.contains("modal-bg")&&l.hideModal()},m=i=>{const s=i.currentTarget,a=s.dataset.y,o=s.dataset.x;if(e.turn&&d.isValidAttack(a,o)&&(e.attack(d,a,o),e.toggleTurn(),t.toggleTurn(),l.renderGrid(d.board,n.p2Grid,!0),f()),d.areShipsSunk()){const e="Player 1 Wins";return l.showPlayAgainButton(),void l.showModal(e)}if(t.turn&&(t.randomAttack(r),setTimeout((()=>{l.renderGrid(r.board,n.p1Grid,!1),e.toggleTurn()}),250),t.setTurn(!1)),r.areShipsSunk()){const e="Player 2 Wins";return l.showPlayAgainButton(),void l.showModal(e)}},v=()=>{r.placedShips.length===i.length?(f(),t.autoPlaceAllShips(d),l.startGame()):(l.hidePlayAgainButton(),l.showModal("Place all your ships"))},f=()=>{n.p2Grid.querySelectorAll(".grid-cell").forEach((e=>{e.addEventListener("click",m)}))};return Object.freeze({init:()=>{l.renderGrid(r.board,n.p1Grid,!1),l.renderGrid(d.board,n.p2Grid,!0),l.createShips(n.shipsContainer),o.addDragDropListeners(),n.changeOrientationBtn.addEventListener("click",c),n.autoPlaceBtn.addEventListener("click",h),n.resetBtn.addEventListener("click",u),n.startBtn.addEventListener("click",v),n.modalBg.addEventListener("click",g),n.playAgainBtn.addEventListener("click",p)}})})().init()})();